<form class="form-horizontal" role="form" style="width:600px">
<input type="hidden" id="address_id" value="{% if data %}{{ data.id }}{% endif %}" post_url="{% if data %}/address/do-edit{% else %}/address/do-add{% endif %}">
  <div class="form-group row" style="margin-bottom:0px">
    <label for="username" class="col-sm-2 control-label">收货人姓名</label>
    <div class="col-sm-3">
    <input type="text" class="form-control input-sm" id="username" placeholder="" value="{% if data %}{{ data.username }}{% endif %}">
      <span class="help-block" name="username"></span>
    </div>
  </div>
  <div class="form-group row" style="margin-bottom:0px">
    <label for="province_id" class="col-sm-2 control-label">省市区</label>
    <div class="col-sm-3">
      <select class="form-control input-sm" id="province_id" placeholder="" onchange="city_init()">
        <option value="">--选择--</option>
        {% for pro in province_list %}
        <option value="{{ pro.province_id }}" {% if data and data["province"]["id"]==pro.province_id %}selected="selected"{% endif %}>{{ pro.province_name }}</option>
        {% endfor %}
      </select>
      <span class="help-block" name="province_id"></span>
    </div>
    <div class="col-sm-3">
      <select class="form-control input-sm" id="city_id" placeholder="" onchange="district_init()">
        <option value="">--选择--</option>
        {% if data %}
        {% for city in city_list %}
        <option value="{{ city.city_id }}" {% if data["city"]["id"]==city.city_id %}selected="selected"{% endif %}>{{ city.city_name }}</option>
        {% endfor %}
        {% endif %}
      </select>
      <span class="help-block" name="city_id"></span>
    </div>
    <div class="col-sm-3">
      <select class="form-control input-sm" id="district_id" placeholder="">
        <option value="">--选择--</option>
        {% if data %}
        {% for district in district_list %}
        <option value="{{ district.district_id }}" {% if data["district"]["id"]==district.district_id %}selected="selected"{% endif %}>{{ district.district_name }}</option>
        {% endfor %}
        {% endif %}
      </select>
      <span class="help-block" name="district_id"></span>
    </div>
  </div>
  <div class="form-group row" style="margin-bottom:0px">
    <label for="address" class="col-sm-2 control-label">详细地址</label>
    <div class="col-sm-9">
      <input type="text" class="form-control input-sm" id="address" placeholder="" value="{% if data %}{{ data.address }}{% endif %}">
      <span class="help-block" name="address"></span>
    </div>
  </div>
  <div class="form-group row" style="margin-bottom:0px">
    <label for="zipcode" class="col-sm-2 control-label">邮编</label>
    <div class="col-sm-3">
      <input type="text" class="form-control input-sm" id="zipcode" placeholder="" value="{% if data %}{{ data.zipcode }}{% endif %}">
      <span class="help-block" name="zipcode"></span>
    </div>
    <label for="email" class="col-sm-3 control-label">邮件地址</label>
    <div class="col-sm-3">
      <input type="text" class="form-control input-sm" id="email" placeholder="" value="{% if data %}{{ data.email }}{% endif %}">
      <span class="help-block" name="email"></span>
    </div>
  </div>
  <div class="form-group row" style="margin-bottom:0px">
    <label for="tel" class="col-sm-2 control-label">固定电话</label>
    <div class="col-sm-3">
      <input type="text" class="form-control input-sm" id="tel" placeholder="" value="{% if data %}{{ data.tel }}{% endif %}">
      <span class="help-block" name="tel"></span>
    </div>
    <label for="phone" class="col-sm-3 control-label">手机号码</label>
    <div class="col-sm-3">
      <input type="text" class="form-control input-sm" id="phone" placeholder="" value="{% if data %}{{ data.phone }}{% endif %}">
      <span class="help-block" name="phone"></span>
    </div>
  </div>
  <div class="form-group" style="margin-bottom:0px">
    <div class="col-sm-offset-4 col-sm-8">
      <button type="button" class="btn btn-warning" onclick="do_add()">保 存</button>
    </div>
  </div>
</form>
<script type="text/javascript">
function city_init(){
  var province_id = $("#province_id").val()
  $.ajax({url:"/address/city-init", type:"GET", dataType:"json", data:"province_id={0}".format(province_id),success:function(response){
    if(response.result == true){
      $("#city_id").html("")
      $("#city_id").append("<option value=''>--选择--</option>");
      $("#district_id").html("")
      $("#district_id").append("<option value=''>--选择--</option>");
      for(var p in response.city_list){
        var pro = response.city_list[p]
        $("#city_id").append("<option value='"+pro.city_id+"'>"+pro.city_name+"</option>");
      }
    }
  }})
}
function district_init(){
  var city_id = $("#city_id").val()
  $.ajax({url:"/address/district-init", type:"GET", dataType:"json", data:"city_id={0}".format(city_id),success:function(response){
    if(response.result == true){
      $("#district_id").html("")
      $("#district_id").append("<option value=''>--选择--</option>");
      for(var p in response.district_list){
        var pro = response.district_list[p]
        $("#district_id").append("<option value='"+pro.district_id+"'>"+pro.district_name+"</option>");
      }
    }
  }})
}
function do_add(){
  var address_id = $("#address_id").val()
  var post_url = $("#address_id").attr("post_url")
  var username = $("#username").val();
  var province_id = $("#province_id").val();
  var city_id = $("#city_id").val();
  var district_id = $("#district_id").val();
  var address = $("#address").val();
  var zipcode = $("#zipcode").val();
  var email = $("#email").val();
  var tel = $("#tel").val();
  var phone = $("#phone").val();

  $("span.help-block").html("")
  if (username == null || username == ""){
    $AlertBox({appendTo:$("span[name=username]"), html:"用户姓名不能为空"}).show();
    $("#username").focus();
    return false;
  }
  if (address == null || address == ""){
    $AlertBox({appendTo:$("span[name=address]"), html:"详细地址不能为空"}).show();
    $("#address").focus();
    return false;
  }
  if (zipcode == null || zipcode == ""){
    $AlertBox({appendTo:$("span[name=zipcode]"), html:"邮编不能为空"}).show();
    $("#zipcode").focus();
    return false;
  }
  
  $.ajax({
      url: post_url,
      type:"post",
      dataType:"json",
      data:encodeURI("username={0}&province_id={1}&city_id={2}&district_id={3}&address={4}&email={5}&zipcode={6}&tel={7}&phone={8}&address_id={9}".format(username, province_id, city_id, district_id, address, email, zipcode, tel, phone, address_id)),
      success: function(response){
        //$("#register_online_confirm_box").tClose();
        if (response.result.return_code == 0){
          //$("#profile div.panel-body").html(response.result.tmpl);
          window.location.reload()
        }else{
          $MsgBox({message:response.result.return_message, appendTo:$("#container")}).show()
        }
      }
  })
}
</script>
